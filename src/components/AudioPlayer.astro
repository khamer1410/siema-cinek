---
interface Props {
	audioSrc: string;
	label: string;
	audioId?: string;
}

const { audioSrc, label, audioId } = Astro.props;
---

<div class="audio-player">
	<button class="play-button" data-audio-src={audioSrc}>
		<svg class="play-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
			<path d="M8 5v14l11-7z" fill="currentColor"/>
		</svg>
		<svg class="pause-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
			<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" fill="currentColor"/>
		</svg>
		<span class="button-text">Play</span>
	</button>
	<span class="audio-label">{label}</span>
	<audio class="audio-element" preload="metadata">
		<source src={audioSrc} type="audio/mpeg" />
	</audio>
</div>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const buttons = document.querySelectorAll('.play-button');

		buttons.forEach(button => {
			const audioSrc = button.getAttribute('data-audio-src');
			const audio = button.parentElement?.querySelector('.audio-element') as HTMLAudioElement;
			const playIcon = button.querySelector('.play-icon') as SVGElement;
			const pauseIcon = button.querySelector('.pause-icon') as SVGElement;
			const buttonText = button.querySelector('.button-text') as HTMLElement;

			if (!audio) return;

			// Stop all other audio when a new one starts
			button.addEventListener('click', () => {
				buttons.forEach(otherButton => {
					if (otherButton !== button) {
						const otherAudio = otherButton.parentElement?.querySelector('.audio-element') as HTMLAudioElement;
						const otherPlayIcon = otherButton.querySelector('.play-icon') as SVGElement;
						const otherPauseIcon = otherButton.querySelector('.pause-icon') as SVGElement;
						const otherButtonText = otherButton.querySelector('.button-text') as HTMLElement;

						if (otherAudio) {
							otherAudio.pause();
							otherAudio.currentTime = 0;
							otherPlayIcon.style.display = 'block';
							otherPauseIcon.style.display = 'none';
							if (otherButtonText) otherButtonText.textContent = 'Play';
							otherButton.classList.remove('playing');
						}
					}
				});

				if (audio.paused) {
					audio.play();
					playIcon.style.display = 'none';
					pauseIcon.style.display = 'block';
					if (buttonText) buttonText.textContent = 'Pause';
					button.classList.add('playing');
				} else {
					audio.pause();
					playIcon.style.display = 'block';
					pauseIcon.style.display = 'none';
					if (buttonText) buttonText.textContent = 'Play';
					button.classList.remove('playing');
				}
			});

			audio.addEventListener('ended', () => {
				playIcon.style.display = 'block';
				pauseIcon.style.display = 'none';
				if (buttonText) buttonText.textContent = 'Play';
				button.classList.remove('playing');
			});
		});
	});
</script>

<style>
	.audio-player {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 1rem;
	}

	.play-button {
		position: relative;
		width: 120px;
		height: 120px;
		border-radius: 50%;
		border: none;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		box-shadow:
			0 8px 24px rgba(102, 126, 234, 0.4),
			0 0 0 0 rgba(102, 126, 234, 0.5),
			inset 0 1px 0 rgba(255, 255, 255, 0.2);
		overflow: hidden;
	}

	.play-button::before {
		content: '';
		position: absolute;
		top: 50%;
		left: 50%;
		width: 0;
		height: 0;
		border-radius: 50%;
		background: rgba(255, 255, 255, 0.3);
		transform: translate(-50%, -50%);
		transition: width 0.6s, height 0.6s;
	}

	.play-button:hover {
		transform: scale(1.05);
		box-shadow:
			0 12px 32px rgba(102, 126, 234, 0.5),
			0 0 0 8px rgba(102, 126, 234, 0.2),
			inset 0 1px 0 rgba(255, 255, 255, 0.2);
	}

	.play-button:active {
		transform: scale(0.95);
	}

	.play-button.playing {
		animation: pulse 2s ease-in-out infinite;
	}

	.play-button.playing::before {
		width: 200px;
		height: 200px;
	}

	@keyframes pulse {
		0%, 100% {
			box-shadow:
				0 8px 24px rgba(102, 126, 234, 0.4),
				0 0 0 0 rgba(102, 126, 234, 0.5),
				inset 0 1px 0 rgba(255, 255, 255, 0.2);
		}
		50% {
			box-shadow:
				0 8px 24px rgba(102, 126, 234, 0.6),
				0 0 0 12px rgba(102, 126, 234, 0.1),
				inset 0 1px 0 rgba(255, 255, 255, 0.2);
		}
	}

	.play-icon,
	.pause-icon {
		width: 48px;
		height: 48px;
		color: white;
		position: relative;
		z-index: 1;
		transition: transform 0.2s;
	}

	.play-button:hover .play-icon,
	.play-button:hover .pause-icon {
		transform: scale(1.1);
	}

	.button-text {
		position: absolute;
		bottom: -2rem;
		color: rgba(255, 255, 255, 0.9);
		font-size: 0.875rem;
		font-weight: 500;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		white-space: nowrap;
	}

	.audio-label {
		color: rgba(255, 255, 255, 0.8);
		font-size: 1.125rem;
		font-weight: 500;
		text-align: center;
		margin-top: 0.5rem;
	}

	.audio-element {
		display: none;
	}

	@media (max-width: 768px) {
		.play-button {
			width: 100px;
			height: 100px;
		}

		.play-icon,
		.pause-icon {
			width: 40px;
			height: 40px;
		}
	}
</style>
